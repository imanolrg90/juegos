<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>En una Nota | Sala de Juegos</title>
      <link rel="icon" type="image/png" href="/assets/favicon.png">
    <link rel="apple-touch-icon" href="/assets/favicon.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="en-una-nota.css">
</head>
<body>

    <div id="gameSetupOverlay" class="overlay-setup">
        <div class="setup-content">
            <a href="../index.html" class="btn-close-setup" title="Volver al Men√∫ Principal">‚úñ</a>
            <h1>üéµ Configuraci√≥n</h1>
            
            <div id="setup-step-1" class="setup-section">
                <h3>1. Elige la Tem√°tica</h3>
                <div id="categoryButtonsContainer" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
                    <p style="color: #666;">Cargando carpetas...</p>
                </div>
            </div>

            <div id="setup-step-2" class="setup-section mode-selection" style="display: none;">
                <h3>2. Duraci√≥n de la Partida</h3>
                <button class="btn-mode" data-mode="15">‚è±Ô∏è Corta (15)</button>
                <button class="btn-mode" data-mode="30">‚è±Ô∏è Media (30)</button>
                <button class="btn-mode" data-mode="50">üî• Marat√≥n (50)</button>
                <br>
                <button id="btnBackToCategories" class="btn-mode btn-back-setup">üîô Volver a Tem√°ticas</button>
            </div>

            <div>
                <h3>üèÜ Sal√≥n de la Fama</h3>
                <div id="rankingsTabs" class="rankings-tabs">
                    <button class="tab-btn active" onclick="window.switchTab(15)">Top 15</button>
                    <button class="tab-btn" onclick="window.switchTab(30)">Top 30</button>
                    <button class="tab-btn" onclick="window.switchTab(50)">Top 50</button>
                </div>
                <ul id="rankingList" class="ranking-list">
                    <li style="text-align: center; color: #777;">Cargando rankings...</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        
        <aside class="panel left-panel">
            <div>
                <h1 class="header-title">En una Nota</h1>
                <p id="progressDisplay" class="progress-info">Selecciona un modo para empezar</p>
            </div>
            
            <div class="game-card-display">
                <div style="text-align:center; margin-bottom:10px;">
    <button id="showQRBtn" class="btn-mode" style="padding:5px 10px; font-size:0.8rem;">üì± Mostrar QR Pulsador</button>
</div>
<div id="qrContainer" style="display:none; background:white; padding:10px; border-radius:10px; margin: 0 auto 10px auto; width:150px;"></div>
                <div id="unknownSongState" class="unknown-state">
                    <div class="big-question-mark">?</div>
                    <div class="equalizer-container">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                    <p style="color: var(--text-muted);">Reproduciendo canci√≥n oculta...</p>
                </div>

                <div id="revealedSongState" class="revealed-state" style="display: none;">
                    <img id="sponsorImg" src="" alt="Portada" style="display: none;">
                    <h2 id="songTitleDisplay" class="revealed-title">T√≠tulo Canci√≥n</h2>
                    <p id="sponsorName" class="revealed-artist">Artista</p>
                </div>

                <audio id="audioPlayer" controls controlsList="nodownload">
                    Tu navegador no soporta audio.
                </audio>
            </div>

            <div class="controls-area">
    <button id="playRandomBtn" class="btn btn-primary">
        üé≤ Poner Canci√≥n Aleatoria
    </button>
    <button id="revealBtn" class="btn btn-reveal" disabled>
        üëÅÔ∏è Mostrar Soluci√≥n
    </button>
    
    <button id="resetGameBtn" class="btn btn-restart">
        üîÑ Reiniciar Partida
    </button>
    <a id="backToMenuBtn" href="../index.html" class="btn btn-back">
        üîô Volver al Hub
    </a>
</div>
        </aside>

        <main class="panel right-panel">
            <div class="panel-header">
                <h2>üèÜ Marcador</h2>
                <span style="font-size: 0.9rem; color: var(--text-muted);">Compite por la gloria</span>
            </div>
            
            <div class="team-creation">
                <input type="text" id="newTeamName" placeholder="Nombre del Equipo..." class="team-input">
                <button id="addTeamBtn" class="btn-add">+</button>
            </div>

            <div id="teamsGrid" class="teams-grid">
                </div>
        </main>

    </div>

    <script src="../js/songs.js"></script>
    <script src="game-nota.js"></script>    
    
    <script>
        // L√≥gica de navegaci√≥n en el setup
        const step1 = document.getElementById('setup-step-1');
        const step2 = document.getElementById('setup-step-2');
        const categoriesContainer = document.getElementById('categoryButtonsContainer');
        const backBtn = document.getElementById('btnBackToCategories');

        // Detectar clic en categor√≠a para avanzar
        if (categoriesContainer) {
            categoriesContainer.addEventListener('click', (e) => {
                // Si el clic fue en un bot√≥n (o dentro de uno), avanzamos
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    step1.style.display = 'none';
                    step2.style.display = 'block';
                }
            });
        }

        // Detectar clic en "Volver" para retroceder
        if (backBtn) {
            backBtn.addEventListener('click', () => {
                step2.style.display = 'none';
                step1.style.display = 'block';
                
                // (Opcional) Limpiar selecci√≥n visual si el juego usa clases 'selected'
                const buttons = categoriesContainer.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.style.opacity = '1';
                });
            });
        }
    </script>
<div id="buzzerWinnerOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.96); z-index:5000; justify-content:center; align-items:center; flex-direction:column; text-align:center;">
    
    <div style="font-size:4rem;">üö®</div>
    
    <h1 id="buzzerWinnerName" style="font-size:5rem; color:#4ecdc4; margin:10px 0; text-transform:uppercase; text-shadow: 0 0 30px rgba(78,205,196,0.6);">NOMBRE EQUIPO</h1>
    <h2 id="buzzerWinnerTime" style="font-size:2rem; color:white; margin-bottom:30px;">Tiempo: 0.00s</h2>
    
    <div style="display:flex; gap:30px; justify-content:center; margin-bottom:30px;">
        <button id="btnBuzzerCorrect" class="btn" style="background: linear-gradient(135deg, #2ecc71, #27ae60); padding: 20px 50px; font-size: 1.8rem; border:none; border-radius:20px; color:white; font-weight:bold; cursor:pointer; box-shadow: 0 10px 30px rgba(46, 204, 113, 0.4); transform: scale(1); transition: transform 0.2s;">
            ‚úÖ Acierto
        </button>
        <button id="btnBuzzerIncorrect" class="btn" style="background: linear-gradient(135deg, #e74c3c, #c0392b); padding: 20px 50px; font-size: 1.8rem; border:none; border-radius:20px; color:white; font-weight:bold; cursor:pointer; box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4); transform: scale(1); transition: transform 0.2s;">
            ‚ùå Fallo
        </button>
    </div>

    <div style="width: 50%; max-width: 600px; background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; border: 1px solid rgba(255,255,255,0.1);">
        <h3 style="color: #888; margin: 0 0 10px 0; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px;">‚è≥ Siguientes en cola:</h3>
        <div id="queueList" style="text-align: left; max-height: 150px; overflow-y: auto; color: #ddd; font-family: monospace; font-size: 1.2rem;">
            </div>
    </div>

    <button onclick="document.getElementById('buzzerWinnerOverlay').style.display='none'" class="btn" style="margin-top:30px; background:transparent; color:#666; border:none; cursor:pointer;">Cerrar sin acci√≥n</button>
</div>
</body>
<script>
        let myTeam = "";

        async function validateAndEnter() {
            // ... (Esta parte de validateAndEnter se queda igual que la ten√≠as) ...
            const input = document.getElementById('teamName').value.trim();
            const errorEl = document.getElementById('errorMsg');
            if(!input) return;
            try {
                const res = await fetch('/api/buzz/check_team', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ team: input })
                });
                const data = await res.json();
                if (data.valid) {
                    myTeam = input.toUpperCase();
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('buzzerScreen').style.display = 'flex';
                    document.getElementById('displayTeamName').textContent = myTeam;
                } else {
                    errorEl.style.display = 'block';
                    errorEl.textContent = "‚ùå Equipo no encontrado. Revisa el PC.";
                }
            } catch(e) { alert("Error de conexi√≥n"); }
        }

        async function pressBuzzer() {
            if (navigator.vibrate) navigator.vibrate(100);
            try {
                const res = await fetch('/api/buzz/press', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ team: myTeam })
                });
                const data = await res.json();
                const msg = document.getElementById('statusMsg');
                
                if(data.success) {
                    if (data.position === 1) {
                        msg.textContent = "üöÄ ¬°ERES EL PRIMERO! üöÄ";
                        msg.style.color = "#2ecc71"; // Verde
                        document.body.style.backgroundColor = "#143a22"; // Fondo verde oscuro moment√°neo
                    } else {
                        msg.textContent = `‚è≥ EN COLA: POSICI√ìN ${data.position}`;
                        msg.style.color = "#f1c40f"; // Amarillo
                    }
                } else {
                    msg.textContent = "Cerrado";
                }
                
                // Restaurar color a los 3s
                setTimeout(() => { 
                    msg.textContent = "Listo..."; 
                    msg.style.color = "white"; 
                    document.body.style.backgroundColor = "#1e1e2f"; 
                }, 3000);

            } catch (e) {}
        }
    </script>
</html>